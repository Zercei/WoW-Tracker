<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WoW Gear Tracker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0 auto;
            padding: 20px;
        }
        #specSelect {
            position: absolute;
            top: 20px;
            right: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 50px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .equipped, .ideal {
            background-color: #d9ead3;
        }
        .crit { background-color: #f4cccc; }
        .mastery { background-color: #cfe2f3; }
        .vers { background-color: #d9ead3; }
        .haste { background-color: #fff2cc; }
        .agility { background-color: #e6b8af; }
        input[type="text"], input[type="number"] {
            width: 100%;
            box-sizing: border-box;
        }
        #totals td {
            font-weight: bold;
        }
        .clear-btn {
            background-color: #f44336;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <select id="specSelect">
        <option value="">Select Specialization</option>
        <!-- Specializations will be dynamically added here -->
    </select>

    <table id="gearTable">
        <tr>
            <th>Slot</th>
            <th>Equipped</th>
            <th>Ideal</th>
            <th>Stat1</th>
            <th>Stat2</th>
            <th>AGI</th>
            <th>Haste</th>
            <th>Mastery</th>
            <th>Crit</th>
            <th>Vers</th>
            <th>Action</th>
        </tr>
        <!-- Rows will be dynamically added here -->
    </table>

    <script>
        const gearSlots = [
            "Head", "Neck", "Shoulders", "Cloak", "Chest", "Wrist", "Gloves", "Belt", "Legs", "Boots",
            "Ring", "Ring", "Trinket", "Trinket", "Weapon", "Off-Hand", "Gems", "Enchants", "Base"
        ];

        const statColors = {
            "Crit": "crit",
            "Mastery": "mastery",
            "Vers": "vers",
            "Haste": "haste",
            "Agility": "agility"
        };

        const specializations = [
            "Blood Death Knight", "Frost Death Knight", "Unholy Death Knight",
            "Guardian Druid",
            "Marksmanship Hunter", "Survival Hunter",
            "Arcane Mage", "Fire Mage", "Frost Mage",
            "Shadow Priest",
            "Outlaw Rogue", "Subtlety Rogue"
        ];

        let currentSpec = "";

        const table = document.getElementById('gearTable');
        const specSelect = document.getElementById('specSelect');

        // Populate specialization dropdown
        specializations.forEach(spec => {
            const option = document.createElement('option');
            option.value = spec;
            option.textContent = spec;
            specSelect.appendChild(option);
        });

        function createTable() {
            // Clear existing rows
            while (table.rows.length > 1) {
                table.deleteRow(1);
            }

            gearSlots.forEach(slot => {
                const row = table.insertRow();
                row.insertCell(0).textContent = slot;
                row.insertCell(1).innerHTML = `<input type="text" class="equipped" name="${slot}_equipped">`;
                row.insertCell(2).innerHTML = `<input type="text" class="ideal" name="${slot}_ideal">`;
                row.insertCell(3).innerHTML = `<select name="${slot}_stat1" onchange="updateStatColor(this)">
                    ${Object.keys(statColors).map(stat => `<option value="${stat}">${stat}</option>`).join('')}
                </select>`;
                row.insertCell(4).innerHTML = `<select name="${slot}_stat2" onchange="updateStatColor(this)">
                    ${Object.keys(statColors).map(stat => `<option value="${stat}">${stat}</option>`).join('')}
                </select>`;
                row.insertCell(5).innerHTML = `<input type="number" name="${slot}_agi" value="0">`;
                row.insertCell(6).innerHTML = `<input type="number" name="${slot}_haste" value="0" class="haste-input">`;
                row.insertCell(7).innerHTML = `<input type="number" name="${slot}_mastery" value="0" class="mastery-input">`;
                row.insertCell(8).innerHTML = `<input type="number" name="${slot}_crit" value="0" class="crit-input">`;
                row.insertCell(9).innerHTML = `<input type="number" name="${slot}_vers" value="0" class="vers-input">`;
                row.insertCell(10).innerHTML = `<button class="clear-btn" onclick="clearRow(this)">Clear</button>`;
            });

            // Add totals row
            const totalsRow = table.insertRow();
            totalsRow.id = 'totals';
            totalsRow.insertCell(0).textContent = 'Totals';
            for (let i = 1; i < 11; i++) {
                totalsRow.insertCell(i).textContent = '';
            }
            for (let i = 5; i < 10; i++) {
                totalsRow.cells[i].textContent = '0';
            }
        }

        function updateStatColor(select) {
            select.className = statColors[select.value];
        }

        function updateTotals() {
            const totals = [0, 0, 0, 0, 0];
            for (let i = 5; i < 10; i++) {
                let columnTotal = 0;
                for (let j = 1; j < table.rows.length - 1; j++) {
                    columnTotal += parseInt(table.rows[j].cells[i].querySelector('input').value) || 0;
                }
                totals[i-5] = columnTotal;
                table.rows[table.rows.length - 1].cells[i].textContent = columnTotal;
            }
        }

        function highlightStatInput(input) {
            if (input.value && input.value !== '0') {
                input.classList.add(input.className.split('-')[0]);
            } else {
                input.classList.remove(input.className.split('-')[0]);
            }
        }

        function clearRow(button) {
            const row = button.closest('tr');
            const inputs = row.querySelectorAll('input, select');
            inputs.forEach(input => {
                if (input.type === 'number' || input.type === 'text') {
                    input.value = '';
                } else if (input.type === 'select-one') {
                    input.selectedIndex = 0;
                }
                if (input.classList.contains('haste-input') || 
                    input.classList.contains('mastery-input') || 
                    input.classList.contains('crit-input') || 
                    input.classList.contains('vers-input')) {
                    input.classList.remove('haste', 'mastery', 'crit', 'vers');
                }
            });
            updateTotals();
            saveData();
        }

        function saveData() {
            if (!currentSpec) return;
            const data = {};
            const inputs = table.querySelectorAll('input, select');
            inputs.forEach(input => {
                data[input.name] = input.value;
            });
            localStorage.setItem(currentSpec, JSON.stringify(data));
        }

        function loadData() {
            if (!currentSpec) return;
            const data = JSON.parse(localStorage.getItem(currentSpec) || '{}');
            const inputs = table.querySelectorAll('input, select');
            inputs.forEach(input => {
                if (data[input.name]) {
                    input.value = data[input.name];
                    if (input.type === 'number') {
                        highlightStatInput(input);
                    }
                } else {
                    if (input.type === 'number' || input.type === 'text') {
                        input.value = '';
                    } else if (input.type === 'select-one') {
                        input.selectedIndex = 0;
                    }
                }
            });
            updateTotals();
        }

        function loadSpecialization(spec) {
            if (currentSpec) {
                saveData(); // Save current spec data before switching
            }
            currentSpec = spec;
            createTable();
            loadData();
            document.title = `WoW Gear Tracker - ${spec}`;
        }

        // Initialize table
        createTable();

        // Event listeners
        table.addEventListener('input', function(e) {
            if (e.target.type === 'number') {
                updateTotals();
                highlightStatInput(e.target);
            }
            saveData();
        });

        specSelect.addEventListener('change', function(e) {
            loadSpecialization(e.target.value);
        });

        // Save data when the page is about to be unloaded
        window.addEventListener('beforeunload', saveData);

        // Initialize stat colors
        document.querySelectorAll('select').forEach(updateStatColor);
    </script>
</body>
</html>